#!/usr/local/bin/ruby

require 'rest-client'
require 'json'
$LOAD_PATH.unshift(File.expand_path("../../lib/", __FILE__))
require 'cake_bot_3000'

robot = CakeBot3000.new

loop do
  response = RestClient::Request.new(
    method: :get,
    url: "#{ARGV[0]}:#{ARGV[1]}/cake_eater/robots/#{ARGV[2]}",
    user: "#{ARGV[2]}",
    password: "#{ARGV[3]}",
  ).execute

  grid = JSON.parse(response)["grid"]
  talky_talky = robot.tell_me_what_you_see(grid)
  talk_talky.each { |words| puts words }
  action = robot.move_here("My Input Goes Here")

  RestClient::Request.new(
    method: :put,
    url: "#{ARGV[0]}:#{ARGV[1]}/cake_eater/robots/#{ARGV[2]}",
    user: "#{ARGV[2]}",
    password: "#{ARGV[3]}",
    payload: {"action":"#{action}"}
  ).execute
end
